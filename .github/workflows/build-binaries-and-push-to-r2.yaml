name: Upload core binary to Cloudflare R2 bucket


on:
    push:


jobs:
    preparation:
        name: Preparation
        runs-on: ubuntu-22.04
        permissions:
            contents: write
            packages: write
            id-token: write
        steps:
            - name: Checkout code
              uses: actions/checkout@v4
              with:
                fetch-depth: "0"
                path: axelar-core
                submodules: recursive
            
            - name: Build and rename axelard binary with commit hash
              run: |
                cd axelar-core
                make build
                commit_hash=$(git rev-parse --short HEAD)
                echo "The commit hash: $commit_hash"
                mkdir ./axelard_$commit_hash/
                sudo mv bin/axelard ./axelard_$commit_hash/
                ls -la ./axelard_$commit_hash/
              
            
            # - uses: ryand56/r2-upload-action@latest
            #   with:
            #     r2-account-id: ${{ secrets.R2_ACCOUNT_ID }}
            #     r2-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID_CF }}
            #     r2-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY_CF }}
            #     r2-bucket: ${{ secrets.R2_BUCKET }}
            #     source-dir: /test.txt
            #     destination-dir: ./